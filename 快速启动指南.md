# MCP服务器快速启动指南

## 📋 前置要求

1. **Python 3.8+**
2. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

## ⚙️ 配置步骤

### 1. 创建配置文件

如果 `config/config.json` 不存在，先复制模板：

```bash
# Windows PowerShell
Copy-Item config\config.json.example config\config.json

# Linux/Mac
cp config/config.json.example config/config.json
```

然后编辑 `config/config.json`：

```json
{
  "global": {
    "disabled_platforms": [],
    "disabled_apis": []
  },
  "groups": {},
  "platforms": {
    "ak317": {
      "ckey": "你的实际CKEY值"
    },
    "xingchenfu": {},
    "lolimi": {}
  }
}
```

**重要**：
- `ak317`平台需要配置有效的`ckey`（从API提供商获取）
- `xingchenfu`和`lolimi`平台无需配置参数

### 2. 验证配置

运行测试脚本验证配置是否正确：

```bash
python test_direct.py
```

**预期结果**：
- ✅ 成功案例会返回URL和类型
- ❌ 失败案例会显示错误信息（如ckey无效、关键词不匹配等）

## 🚀 启动MCP服务器

### 方式1: 直接运行（用于测试/调试）

```bash
python mcp_server.py
```

服务器会通过标准输入/输出进行通信。

### 方式2: 在MCP客户端中配置

#### Claude Desktop配置

编辑 `claude_desktop_config.json`（通常在用户配置目录）：

```json
{
  "mcpServers": {
    "media-api": {
      "command": "python",
      "args": ["C:/Users/Hua/Desktop/work/PyProjects/media_api/mcp_server.py"],
      "cwd": "C:/Users/Hua/Desktop/work/PyProjects/media_api"
    }
  }
}
```

#### Cursor配置

在项目根目录创建或编辑 `.cursor/mcp.json`：

```json
{
  "mcpServers": {
    "media-api": {
      "command": "python",
      "args": ["mcp_server.py"],
      "cwd": "C:/Users/Hua/Desktop/work/PyProjects/media_api"
    }
  }
}
```

配置后重启客户端即可使用。

## 🧪 测试方法

### 快速测试（推荐）

直接调用核心函数，无需MCP协议：

```bash
python test_direct.py
```

### 完整测试

通过MCP协议完整测试：

```bash
python test_mcp.py
```

## 📝 使用示例

### 在代码中直接调用

```python
import asyncio
from mcp_server import get_media

async def example():
    # 获取自拍图片
    result = await get_media("自拍", "image")
    print(result)
    
    # 获取热舞视频
    result = await get_media("热舞", "video")
    print(result)

asyncio.run(example())
```

### 通过MCP工具调用

工具名称：`get_media`

**参数**：
- `query`（必需）：搜索关键词
- `media_type`（可选）：媒体类型，默认"all"
  - 可选值：`"image"` / `"video"` / `"audio"` / `"all"`

**返回格式**：
```json
{
  "url": "https://example.com/media.jpg",
  "type": "image"
}
```

或错误：
```json
{
  "error": "错误信息"
}
```

## 🔍 支持的关键词

### AK317平台
- **图片**：`"自拍"`
- **视频**：`"倾梦"`、`"猫系"`、`"少萝"`、`"热舞"`、`"黑丝"`、`"白丝"`等25个关键词

### 星晨福平台
- **视频**：`"女大"`、`"黑丝"`、`"白丝"`、`"小姐姐"`、`"jk"`、`"cos"`等
- **图片**：`"黑丝图片"`、`"美腿"`、`"cosplay"`等

### Lolimi平台
- 支持任意关键词，返回随机视频

详细关键词列表请参考 `README.md`

## ❗ 常见问题

### 1. ckey不存在错误

**问题**：`[错误码 217] ckey不存在！`

**解决**：在`config/config.json`中配置有效的`ckey`值

### 2. 关键词不匹配

**问题**：`未匹配到关键词`

**解决**：使用支持的关键词，或查看错误信息中列出的可用关键词

### 3. 平台不可用

**问题**：`没有可用的平台`

**解决**：
- 检查`config/config.json`中的`disabled_platforms`配置
- 确认平台配置是否完整
- 查看日志了解详细原因

### 4. Windows编码问题

**问题**：控制台显示乱码

**解决**：测试脚本已自动处理，如果仍有问题，手动设置：
```bash
chcp 65001
```

## 📚 更多信息

- 详细文档：`README.md`
- 设计文档：`DESIGN.md`
- 测试指南：`MCP测试指南.md`

